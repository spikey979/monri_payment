(()=>{"use strict";var e={20:(e,t,n)=>{var r=n(609),s=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,c={},l=null,d=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!i.hasOwnProperty(r)&&(c[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===c[r]&&(c[r]=t[r]);return{$$typeof:s,type:e,key:l,ref:d,props:c,_owner:o.current}}t.jsx=c,t.jsxs=c},609:e=>{e.exports=window.React},848:(e,t,n)=>{e.exports=n(20)}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}const r=window.wc.wcBlocksRegistry,s=window.wp.htmlEntities,a=window.wc.wcSettings,o=()=>{const e=(0,a.getSetting)("monri_data",null);if(!e)throw new Error("Monri settings not available");return e},i=()=>o();var c=n(609);const l=window.wp.data,{CART_STORE_KEY:d}=wc.wcBlocksData,u=()=>(0,l.useSelect)(e=>e(d).getCartData()),m=window.wp.i18n;var p=n(848);const{extensionCartUpdate:h}=wc.blocksCheckout,f=e=>{h({namespace:"monri-payments",data:{installments:e}})},y=()=>{const e=i().installments,[t,n]=(0,c.useState)(0);(0,c.useEffect)(()=>{f(t)},[t]),(0,c.useEffect)(()=>()=>{f(0)},[]);const r=(0,c.useMemo)(()=>(e=>{if(e<1)return[];const t=[{label:(0,m.__)("No installments","monri"),value:0}];for(let n=2;n<=e;n++)t.push({label:n,value:n});return t})(e),[e]),s=(0,c.useId)(),a=-1!==[...u().fees].findIndex(e=>"monri_installments_fee"===e.key)?(0,m.__)("An additional installments fee has been applied","monri"):null;return r.length<1?null:(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:s,children:(0,m.__)("Number of installments: ","monri")}),(0,p.jsx)("select",{id:s,onChange:e=>{return t=e.target.value,n(t);var t},value:t,children:r.map(({label:e,value:t})=>(0,p.jsx)("option",{value:t,children:e},`installments-${t}`))}),a&&(0,p.jsx)("div",{className:"installments-notice",children:a})]})},w=()=>{const e=o(),t=(0,s.decodeEntities)(e.title)||(0,m.__)("Monri","monri");return{name:"monri",label:t,ariaLabel:t,canMakePayment:()=>!0,supports:{features:e.supports}}},_=()=>{const e=i(),t=e.installments;return(0,p.jsxs)(c.Fragment,{children:[(0,s.decodeEntities)(e.description||""),t?(0,p.jsx)(y,{}):""]})},b=()=>{const e=i(),t=e.installments;return(0,p.jsxs)(c.Fragment,{children:[(0,s.decodeEntities)(e.description||""),t?(0,p.jsx)(y,{}):""]})},E=window.Monri,x=e=>{const t=i(),n=u(),{eventRegistration:r,emitResponse:a}=e,{onPaymentSetup:o}=r,l=(0,c.useId)(),d=(0,c.useRef)(null),h=(0,c.useRef)(null),[f,y]=(0,c.useState)(t.components.client_secret),w=(0,c.useRef)(null);return(0,c.useEffect)(()=>{w.current&&(w.current.innerHTML=""),d.current=E(t.components.authenticity_token,{locale:t.components.locale});const e=d.current.components({clientSecret:f});h.current=e.create("card",{style:{invalid:{color:"red"}},showInstallmentsSelection:t.installments,tokenizePanOffered:t.tokenization}),h.current.mount(l)},[f]),(0,c.useEffect)(()=>{y(n.extensions["woocommerce-monri"].client_secret);const e=o(async()=>{try{const e=await(async e=>{const t={address:e.address_1,fullName:`${e.first_name} ${e.last_name}`,city:e.city,zip:e.postcode,phone:e.phone,country:e.country,email:e.email};for(const[e,n]of Object.entries(t))if(Object.prototype.hasOwnProperty.call(t,e)&&n.toString().trim().length<1)throw new Error((0,m.sprintf)((0,m.__)("%s is a required field","woocommerce"),g(e)));const n=await d.current.confirmPayment(h.current,t);if(n.error)throw new Error(n.error.message);if("approved"===n.result.status)return n.result;throw new Error((0,m.__)("Transaction declined, please reload the page.","monri"))})(n.billingAddress);return{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:{"monri-transaction":JSON.stringify(e)}}}}catch(e){return{type:a.responseTypes.ERROR,message:e.message}}});return()=>{e()}},[a.responseTypes.ERROR,a.responseTypes.SUCCESS,n,o]),(0,p.jsxs)(c.Fragment,{children:[(0,s.decodeEntities)(t.description||""),(0,p.jsx)("br",{}),(0,p.jsx)("div",{id:l,ref:w})]})},g=e=>{let t=e;switch(e){case"address":t=(0,m.__)("Address","woocommerce");break;case"fullName":t=(0,m.__)("Name.","woocommerce");break;case"city":t=(0,m.__)("City","woocommerce");break;case"zip":t=(0,m.__)("Postal code","woocommerce");break;case"phone":t=(0,m.__)("Phone","woocommerce");break;case"country":t=(0,m.__)("Country/Region","woocommerce");break;case"email":t=(0,m.__)("Email address","woocommerce")}return t},v=window.wc.wcBlocksData,S=e=>{try{const t=e.paymentDetails;let n=document.createElement("script");n.src=t.src,n.className="lightbox-button",n.setAttribute("data-authenticity-token",t["data-authenticity-token"]),n.setAttribute("data-amount",t["data-amount"]),n.setAttribute("data-currency",t["data-currency"]),n.setAttribute("data-order-number",t["data-order-number"]),n.setAttribute("data-order-info",t["data-order-info"]),n.setAttribute("data-digest",t["data-digest"]),n.setAttribute("data-transaction-type",t["data-transaction-type"]),n.setAttribute("data-language",t["data-language"]),n.setAttribute("data-success-url-override",t["data-success-url-override"]),n.setAttribute("data-cancel-url-override",t["data-cancel-url-override"]),n.setAttribute("data-callback-url-override",t["data-callback-url-override"]),n.setAttribute("data-ch-full-name",t["data-ch-full-name"]),n.setAttribute("data-ch-zip",t["data-ch-zip"]),n.setAttribute("data-ch-phone",t["data-ch-phone"]),n.setAttribute("data-ch-email",t["data-ch-email"]),n.setAttribute("data-ch-address",t["data-ch-address"]),n.setAttribute("data-ch-city",t["data-ch-city"]),n.setAttribute("data-ch-country",t["data-ch-country"]),t["data-number-of-installments"]&&n.setAttribute("data-number-of-installments",t["data-number-of-installments"]),t["data-tokenize-pan"]&&n.setAttribute("data-tokenize-pan",t["data-tokenize-pan"]),t["data-supported-payment-methods"]&&n.setAttribute("data-supported-payment-methods",t["data-supported-payment-methods"]),document.querySelector(".wc-block-components-form").appendChild(n),n.onload=()=>{document.querySelector("button.monri-lightbox-button-el").click()},n.onerror=function(){console.log("something went wrong")}}catch(e){console.error("Error: ",e)}},k=()=>{const e=i(),t=e.installments,{isComplete:n,paymentResult:r}=(0,l.useSelect)(e=>{const t=e(v.CHECKOUT_STORE_KEY),n=e(v.PAYMENT_STORE_KEY);return{isComplete:t.isComplete(),paymentResult:n.getPaymentResult()}});return(0,c.useEffect)(()=>{n&&S(r)},[n]),(0,p.jsxs)(c.Fragment,{children:[(0,s.decodeEntities)(e.description||""),t?(0,p.jsx)(y,{}):""]})},j=()=>{const e=i(),t=e.installments,{isComplete:n,paymentResult:r}=(0,l.useSelect)(e=>{const t=e(v.CHECKOUT_STORE_KEY),n=e(v.PAYMENT_STORE_KEY);return{isComplete:t.isComplete(),paymentResult:n.getPaymentResult()}});return(0,c.useEffect)(()=>{n&&S(r)},[n]),(0,p.jsxs)(c.Fragment,{children:[(0,s.decodeEntities)(e.description||""),t?(0,p.jsx)(y,{}):""]})},R=()=>{const e=i();return(0,s.decodeEntities)(e.description||"")},C=(()=>{const e=i();switch(e.service){case"monri-ws-pay":return(()=>{const e={...w(),content:(0,p.jsx)(R,{}),edit:(0,p.jsx)(R,{})};return-1!==i().supports.indexOf("tokenization")&&(e.supports.showSaveOption=!0,e.supports.showSavedCards=!0),e})();case"monri-web-pay":return"components"===e.integration_type?{...w(),content:(0,p.jsx)(x,{}),edit:(0,p.jsx)(x,{})}:"lightbox"===e.integration_type?(()=>{const e={...w(),content:(0,p.jsx)(k,{}),edit:(0,p.jsx)(k,{}),savedTokenComponent:(0,p.jsx)(j,{})};return-1!==i().supports.indexOf("tokenization")&&(e.supports.showSaveOption=!0,e.supports.showSavedCards=!0),e})():(()=>{const e={...w(),content:(0,p.jsx)(_,{}),edit:(0,p.jsx)(_,{}),savedTokenComponent:(0,p.jsx)(b,{})};return-1!==i().supports.indexOf("tokenization")&&(e.supports.showSaveOption=!0,e.supports.showSavedCards=!0),e})()}})();(0,r.registerPaymentMethod)(C)})();